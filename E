--// CONFIG
local WAIT_TIME = 2
local MESH_ID = "rbxassetid://129768917989779"
local SCRIPT_URL = ""

--// SERVIÇOS
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer

--// ESTADO GLOBAL (PERSISTE ENTRE SERVERS)
getgenv().AutoFarmEnabled = getgenv().AutoFarmEnabled or false

--// FARM ORIGINAL
local function farmItems()
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    for _, obj in ipairs(workspace:GetDescendants()) do
        if not getgenv().AutoFarmEnabled then return end

        if obj:IsA("SpecialMesh")
        and obj.MeshId == MESH_ID
        and obj.Parent:IsA("BasePart") then

            hrp.CFrame = obj.Parent.CFrame + Vector3.new(0, 3, 0)
            task.wait(0.5)
        end
    end
end

--// SERVER HOP
local function serverHop()
    local placeId = game.PlaceId
    local servers = HttpService:JSONDecode(
        game:HttpGet(
            "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"
        )
    )

    for _, server in ipairs(servers.data) do
        if server.playing < server.maxPlayers then
            TeleportService:TeleportToPlaceInstance(placeId, server.id, player)
            break
        end
    end
end

--// LOOP PRINCIPAL
local function startAutoFarm()
    task.spawn(function()
        while getgenv().AutoFarmEnabled do
            farmItems()
            task.wait(WAIT_TIME)

            if getgenv().AutoFarmEnabled then
                serverHop()
                break
            end
        end
    end)
end

--// REEXECUTAR APÓS TELEPORT
local queued = [[
    getgenv().AutoFarmEnabled = true
    loadstring(game:HttpGet("]] .. SCRIPT_URL .. [["))()
]]

if syn and syn.queue_on_teleport then
    syn.queue_on_teleport(queued)
elseif queue_on_teleport then
    queue_on_teleport(queued)
end

--// GUI
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "PoderosoHub"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,300,0,180)
frame.Position = UDim2.new(0.5,-150,0.5,-90)
frame.BackgroundColor3 = Color3.fromRGB(15,15,15)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,40)
title.BackgroundTransparency = 1
title.Text = "Poderoso Hub Auto Farm"
title.TextColor3 = Color3.fromRGB(0,255,170)
title.Font = Enum.Font.GothamBold
title.TextSize = 18

local sub = Instance.new("TextLabel", frame)
sub.Size = UDim2.new(1,0,0,25)
sub.Position = UDim2.new(0,0,0,40)
sub.BackgroundTransparency = 1
sub.Text = "by Ressel and Luis22"
sub.TextColor3 = Color3.fromRGB(200,200,200)
sub.Font = Enum.Font.Gotham
sub.TextSize = 14

local onBtn = Instance.new("TextButton", frame)
onBtn.Size = UDim2.new(0.8,0,0,40)
onBtn.Position = UDim2.new(0.1,0,0,80)
onBtn.Text = "Ativar"
onBtn.BackgroundColor3 = Color3.fromRGB(0,170,0)
onBtn.TextColor3 = Color3.new(1,1,1)
onBtn.Font = Enum.Font.GothamBold
onBtn.TextSize = 16

local offBtn = Instance.new("TextButton", frame)
offBtn.Size = UDim2.new(0.8,0,0,40)
offBtn.Position = UDim2.new(0.1,0,0,130)
offBtn.Text = "Desativar"
offBtn.BackgroundColor3 = Color3.fromRGB(170,0,0)
offBtn.TextColor3 = Color3.new(1,1,1)
offBtn.Font = Enum.Font.GothamBold
offBtn.TextSize = 16

onBtn.MouseButton1Click:Connect(function()
    if not getgenv().AutoFarmEnabled then
        getgenv().AutoFarmEnabled = true
        startAutoFarm()
    end
end)

offBtn.MouseButton1Click:Connect(function()
    getgenv().AutoFarmEnabled = false
end)

--// AUTO START (QUANDO VEM DE SERVER HOP)
if getgenv().AutoFarmEnabled then
    startAutoFarm()
end
